@model MDS.Models.StartEndDate
@{
    ViewBag.Title = "Report";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/CSS/style.css" rel="stylesheet" />
<script src="~/Scripts/jquery-1.12.4.js"></script>
<script src="~/Scripts/jquery.validate.js"></script>
<script src="~/Scripts/jquery-ui-1.12.1.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css" />
<script type="text/javascript">
    function ServiceLink(id) {
        window.open("../../ServiceWorkOrder/Edit?id=" + id);
    }

    function RepairLink(id) {
        window.open("../../Repair/Edit?id=" + id);
    }
</script>
<div class="contact-info">
    <div class="content">
        <div id="dialog"></div>
        <table width="100%">
            <tr>
                <th>
                    <b>
                        From
                    </b>
                </th>
                <td>
                    @Html.EditorFor(i => i.From)
                </td>
                <th>
                    <b>
                        To
                    </b>
                </th>
                <td>
                    @Html.EditorFor(i => i.To)
                </td>
                <td width="70" class="text">
                    Customer:
                </td>
                <td>
                    @Html.HiddenFor(i => i.Customerid)
                    @Html.EditorFor(i => i.CustomerSearch, new { htmlAttributes = new { style = "width:400px", onkeyup = "autosearch();return false;", autocomplete = "off" } })
                    <br />
                    <div id="searchresults"></div>
                </td>

                <script type="text/javascript">
    var results = 0;
    $('#searchresults').hide();
                                        function autosearch() {
                                            $('#searchresults').show();
                                            try {
                                                $('#Customerid').val(0);
                                                //$("#btn").prop("value", "Create This as new part in Parts List");
                                                var From = $('#From').val();
                                                var To = $('#To').val();

                                                var searchString = $('#CustomerSearch').val();// $(this).val(); //Get the value from this TextBox
                                                var data = { searchString: searchString, From: From, To: To };
                                                $.post('@Url.Action("CustSearchEquipServiceDates", "Customer")', data, function (data) {
                                                    if (data.results == null) {
                                                        alert('no results');
                                                        results = 0;
                                                    }
                                                    else {
                                                        results = data.results.length;
                                                        if (data.results.length == 0) {
                                                            ;//alert('0 results.  Do you ');

                                                        }
                                                        var divstring = '';
                                                        for (var i = 0; i < data.results.length; i++) {
                                                            divstring = divstring + "<a id='" + data.results[i].Code + "' href='' onclick='selectx(\"" + data.results[i].Code + "\");return false;'>" + data.results[i].Code + "~" + data.results[i].Desc + "</a><br/>";
                                                        }
                                                        $("#searchresults").html(divstring);
                                                    }
                                                }
                                                );
                                            }
                                            catch (ex) {
                                                alert(ex.message);
                                            }
                                        }

                                        function selectx(num) {
                                            try {

                                                var desc = document.getElementById(num).innerText;
                                                var parts = desc.split("~");
                                                //alert(parts);
                                                if (parts[1] == "-Add-") {
                                                   // alert('adding ' + parts[0]);
                                                    var data = { searchString: parts[0] }
                                                    $.post('@Url.Action("CustAdd", "Customer")', data, function (data) {
                                                        if (data.error == '') {
                                                            alert('Added with code:' + data.code);
                                                            $('#Customerid').val(data.code);
                                                            $('#CustomerSearch').val(parts[0]);
                                                            RefreshPhoto();
                                                            return;
                                                        }
                                                        else {
                                                            alert(data.error);

                                                            return;
                                                        }
                                                    }
                                                    );
                                                }
                                                $('#Customerid').val(parts[0]);
                                                $('#CustomerSearch').val(parts[1]);
                                                $('#searchresults').hide();
                                                RefreshPhoto();

                                            }
                                            catch (ex) {
                                                alert(ex.message);
                                            }
                                            return false;
                                        }

                </script>

                <td>
                    <input class="inputbuttonbg inputbig" type="button" onclick="RefreshPhoto()" value="Refresh" />
                </td>
                <td>
                    <a href="~/Customer/CustEquipServiceExcel"><img src="~/Images/excel.png" /></a>
                </td>
            </tr>
            <tr>
                <td colspan="8">
                    <div id="PhotosX" />
                </td>
            </tr>
        </table>
    </div>
</div>
<script type="text/javascript">
            var div = $("#dialog");

            function RefreshPhoto() {
                try {
                var CustCode=$('#Customerid').val();
                var From = $('#From').val();
                var To = $('#To').val();

                $.ajax({
                    url: '@Url.Content("~/Customer/CustEquipService")',
                    type: 'POST',
                    data: { From: From, To: To, CustCode: CustCode },
                    success: doSubmitSuccess
                });
            }
            catch (ex) {
                alert('Error in init():' + ex.message);
            }
        }
    RefreshPhoto();
        function doSubmitSuccess(result) {
            try {
                $('#PhotosX').html(result);
            }
            catch (ex) {
                alert('Error in doSubmitSuccess():' + ex.message);
            }
        }
//    RefreshPhoto();
</script>
