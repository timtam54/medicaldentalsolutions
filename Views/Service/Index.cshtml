@model MDS.Models.ServiceSearch

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style type="text/css">
    td {
        padding: 5px;
    }

    #svGrid tbody tr:hover {
        cursor: pointer !important;
    }
</style>
<h1>Service Job Search</h1>
@using (Html.BeginForm("Index", "Service", FormMethod.Post, new { id = "svForm" }))
{
    <div class="contact-info">
        <div class="content">
            <table width="100%">
                <tr>
                    <td>Tech Status:</td>
                    <td colspan="2">
                        @if (!MDS.Controllers.LoginController.AllCustomers(@User.Identity.Name))
                        {
                            <span><u>Resolved or Incomplete</u></span>
                        }
                        else
                        {
                            if (Model.ServiceWork == "C")
                            {
                                @Html.RadioButtonFor(m => m.ServiceWork, "C", new { Name = "ServiceWork", Checked = "checked", onclick = "CompMonthfn();" }) <span>Complete</span>
                                @Html.RadioButtonFor(m => m.ServiceWork, "I", new { Name = "ServiceWork", onclick = "CompMonthfn();" }) <span>Incomplete</span>
                                @Html.RadioButtonFor(m => m.ServiceWork, "E", new { Name = "ServiceWork", onclick = "CompMonthfn();" })<span>Either</span>
                                @Html.RadioButtonFor(m => m.ServiceWork, "M", new { Name = "ServiceWork", onclick = "CompMonthfn();" })<span>Completed In Month <div id="CompMonth">@Html.DropDownListFor(i => i.ServiceWorkCompMonth, new SelectList(ViewBag.ServiceWorkCompMonthX, "Key", "Desc"), "-Select One-", new { style = "width:350px" })</div></span>

                            }
                            else if (Model.ServiceWork == "E")
                            {
                                @Html.RadioButtonFor(m => m.ServiceWork, "C", new { Name = "ServiceWork", onclick = "CompMonthfn();" }) <span>Complete</span>
                                @Html.RadioButtonFor(m => m.ServiceWork, "I", new { Name = "ServiceWork", onclick = "CompMonthfn();" }) <span>Incomplete</span>
                                @Html.RadioButtonFor(m => m.ServiceWork, "E", new { Name = "ServiceWork", Checked = "checked", onclick = "CompMonthfn();" })<span>Either</span>
                                @Html.RadioButtonFor(m => m.ServiceWork, "M", new { Name = "ServiceWork", onclick = "CompMonthfn();" })<span>Completed In Month <div id="CompMonth">@Html.DropDownListFor(i => i.ServiceWorkCompMonth, new SelectList(ViewBag.ServiceWorkCompMonthX, "Key", "Desc"), "-Select One-", new { style = "width:350px" })</div></span>
                            }

                            else
                            {
                                @Html.RadioButtonFor(m => m.ServiceWork, "C", new { Name = "ServiceWork", onclick = "CompMonthfn();" }) <span>Complete</span>
                                @Html.RadioButtonFor(m => m.ServiceWork, "I", new { Name = "ServiceWork", Checked = "checked", onclick = "CompMonthfn();" }) <span>Incomplete</span>
                                @Html.RadioButtonFor(m => m.ServiceWork, "E", new { Name = "ServiceWork", onclick = "CompMonthfn();" })<span>Either</span>
                                @Html.RadioButtonFor(m => m.ServiceWork, "M", new { Name = "ServiceWork", onclick = "CompMonthfn();" })<span>Completed In Month <div id="CompMonth">@Html.DropDownListFor(i => i.ServiceWorkCompMonth, new SelectList(ViewBag.ServiceWorkCompMonthX, "Key", "Desc"), "-Select One-", new { style = "width:350px" })</div></span>
                            }
                        }
                    </td>
                    <td align="center">
                        Invoice (Complete):
                    </td>
                    <td colspan="2">

                        @if (Model.Invoice == "R")
                        {
                            @Html.RadioButtonFor(m => m.Invoice, "R", new { Name = "Invoice", Checked = "checked" }) <span>Raised</span>
                            @Html.RadioButtonFor(m => m.Invoice, "N", new { Name = "Invoice" }) <span>Not Raised</span>
                            @Html.RadioButtonFor(m => m.Invoice, "E", new { Name = "Invoice" }) <span>Either</span>

                        }

                        else if (Model.Invoice == "N")
                        {
                            @Html.RadioButtonFor(m => m.Invoice, "R", new { Name = "Invoice" }) <span>Raised</span>
                            @Html.RadioButtonFor(m => m.Invoice, "N", new { Name = "Invoice", Checked = "checked" }) <span>Not Raised</span>
                            @Html.RadioButtonFor(m => m.Invoice, "E", new { Name = "Invoice" }) <span>Either</span>
                        }

                        else
                        {
                            @Html.RadioButtonFor(m => m.Invoice, "R", new { Name = "Invoice" }) <span>Raised</span>
                            @Html.RadioButtonFor(m => m.Invoice, "N", new { Name = "Invoice" }) <span>Not Raised</span>
                            @Html.RadioButtonFor(m => m.Invoice, "E", new { Name = "Invoice", Checked = "checked" }) <span>Either</span>
                        }
                        @*@Model.Invoice*@

                    </td>
                </tr>
                <tr>
                    <td width="100">
                        Engineer:
                    </td>
                    <td>
                        @(Html.Kendo().DropDownListFor(m => m.EngineerID)
                    .Filter("startswith")
                            .Name("EngineerID")
                            .DataTextField("EngineerName")
                            .DataValueField("EngineerID")
                            .BindTo(Model.EngineerList)
                            .HtmlAttributes(new { style = "width:200px" })
                            .Filter("startswith")
                            )

                    </td>
                    <td width="100">
                        Customer:
                    </td>
                    <td>
                        @(Html.Kendo().DropDownListFor(m => m.Customerid)
                          .Name("Customerid")
                          .DataTextField("CompanyName")
                          .DataValueField("CustomerCode")
                         .Enable(MDS.Controllers.LoginController.AllCustomers(User.Identity.Name))
.Filter(MDS.Controllers.LoginController.SearchType)
                          .BindTo(Model.CustomerList)
                          .HtmlAttributes(new { style = "width:200px", data_required_msg = "Customer is required." })
                        )

                    </td>
                    <td width="100">
                        Customer-Site:
                    </td>
                    <td>
                        @(Html.Kendo().DropDownListFor(m => m.Department)

                          .Name("Department")
                          .DataTextField("Department")
                          .DataValueField("DepartmentID")
                          .DataSource(dataSource =>
                          {
                              dataSource.Read(read =>
                              {
                                  read.Action("GetCustomerSiteX", "Service")
                                     .Data("CustomerSiteData");
                              })
                              .ServerFiltering(true);
                          })
                                  .AutoBind(false)
                                 .CascadeFrom("Customerid")
                           .HtmlAttributes(new { style = "width:200px" })
                        )
                    </td>
                </tr>
                <tr>
                    <td>
                        Location:
                    </td>
                    <td>
                        @(Html.Kendo().DropDownListFor(m => m.Locationid)

                                .Name("Locationid")
                                .DataTextField("Location")
                                .DataValueField("Locationid")
                                .DataSource(dataSource =>
                                {
                                    dataSource.Read(read =>
                                    {
                                        read.Action("GetCustomerLocationBlank", "Service")
                                           .Data("CustomerSiteData");
                                    })
                                    .ServerFiltering(true);
                                })
                                  .AutoBind(false)
                                 .CascadeFrom("Customerid")
                                .HtmlAttributes(new { style = "width:200px" })
                            )
                    </td>
                    <td>
                        Service Job #:
                    </td>
                    <td>
                        @(Html.Kendo().TextBoxFor(m => m.ServiceJob)
                                .Name("ServiceJob")
                                .HtmlAttributes(new { style = "width:200px" })
                            )

                    </td>
                    <td>
                        Customer Order No:
                    </td>
                    <td>
                        @(Html.Kendo().TextBoxFor(m => m.CustomerOrderNo)
                                .Name("CustomerOrderNo")
                                .HtmlAttributes(new { style = "width:200px" })
                            )
                    </td>
                </tr>
                <tr>
                    <td>
                        Date In Filter:
                    </td>
                    <td>
                        @if (Model.DateInFilter)
                        {
                            @Html.CheckBox("ChkDateInFilter", true, new { @onclick = "ChkDateInFilterCheck();", style = "width:20px;height:20px;text-align:left" })
                        }
                        else
                        {
                            @Html.CheckBox("ChkDateInFilter", false, new { @onclick = "ChkDateInFilterCheck();", style = "width:20px;height:20px;text-align:left" })
                        }
                    </td>
                    <td class="datein">
                        Date In From/To:
                    </td>
                    <td class="datein">
                        @Html.EditorFor(m => m.FromDate)
                        @Html.ValidationMessageFor(m => m.FromDate)


                        @*@(Html.Kendo().DatePickerFor(m => m.FromDate)
                                            .Name("FromDate")
                                            .Value(DateTime.Now.AddMonths(-1))
                                            .Format("dd/MM/yyyy")
                                            .ParseFormats(new string[] { "dd/MM/yyyy" })
                            .HtmlAttributes(new { required = "required", type = "text", data_required_msg = "Date In is required." })
                                            )*@

                    </td>
                    <td class="datein">
                        @Html.EditorFor(m => m.ToDate)
                        @Html.ValidationMessageFor(m => m.ToDate)

                        @*@(Html.Kendo().DatePickerFor(m => m.ToDate)
                                            .Name("ToDate")
                                            .Value(DateTime.Now)
                                            .Format("dd/MM/yyyy")
                            .HtmlAttributes(new { required = "required", type = "text", data_required_msg = "Date Out is required." })
                                            )*@
                    </td>
                    <td></td>
                </tr>
                <tr>
                    <td>
                        Date Out Filter:
                    </td>
                    <td>

                        @if (Model.DateOutFilter)
                        {
                            @Html.CheckBox("ChkDateOutFilter", true, new { @onclick = "ChkDateOutFilterClick();", style = "width:20px;height:20px;text-align:left" })
                        }
                        else
                        {
                            @Html.CheckBox("ChkDateOutFilter", false, new { @onclick = "ChkDateOutFilterClick();", style = "width:20px;height:20px;text-align:left" })
                        }


                    </td>
                    <td class="dateout">
                        Date Out From/To:
                    </td>
                    <td class="dateout">
                        @Html.EditorFor(m => m.OutFromDate)
                        @Html.ValidationMessageFor(m => m.OutFromDate)

                        @*@(Html.Kendo().DatePickerFor(m => m.OutFromDate)
                                                        .Name("OutFromDate")
                                                        .Value(DateTime.Now.AddMonths(-1))
                                                        .Format("dd/MM/yyyy")
                                                        .ParseFormats(new string[] { "dd/MM/yyyy" })
                            .HtmlAttributes(new { style = "width:120px", type = "text" })
                                                        )*@

                    </td>
                    <td class="dateout">

                        @Html.EditorFor(m => m.OutToDate)
                        @Html.ValidationMessageFor(m => m.OutToDate)

                    </td>
                    <td></td>
                </tr>

                <tr>
                    <td>
                        Branch:
                    </td>
                    <td>
                        @(Html.Kendo().DropDownListFor(m => m.Branchid)

                          .Name("Branchid")
                          .DataTextField("BranchName")
                          .DataValueField("BranchID")
                          .Enable(MDS.Controllers.LoginController.AllCustomers(User.Identity.Name))

                          .BindTo(Model.BranchList)
                          .HtmlAttributes(new { style = "width:150px" })
                        )
                    </td>

                    <td colspan="2">
                        <table>
                            <tr style="color:navy">
                                <td>
                                    Limit number of Records to no more than:
                                </td>
                                <td>
                                    @(Html.Kendo().DropDownListFor(m => m.SelCnt)
                          .Name("SelCnt")
                          .BindTo(Model.Cnt)
                          .HtmlAttributes(new { style = "width:100%", data_required_msg = "Records is required." })

                          )
                                </td>
                            </tr>
                        </table>
                    </td>

                    <td>
                        <a class="button" onclick="$('#svForm').submit();"><span>Search</span></a>
                        @Html.HiddenFor(m => m.DateInFilter)
                        @Html.HiddenFor(m => m.DateOutFilter)
                    </td>
                </tr>
                <tr>
                    <td colspan="6">
                        @if (MDS.Controllers.LoginController.IsAdmin(@User.Identity.Name) == MDS.Controllers.ATC.Admin)
                        {

                            <input type="button" class="inputbuttonbg inputbig" value="Add New Service" onclick="window.location.href = 'service/add'">
                            <input type="button" class="inputbuttonbg inputbig" value="Delete Service Job" id="btnDelete">
                        }


                        @*   </td>

                             </tr>
                            <tr>
                                            <td colspan="6">*@
                        <input id="btnServiceJobList" type="submit" class="inputbuttonbg inputbig" value="Print Service Job List">
                        <input type="image" value="Excel" src="~/Images/excel.png" id="btnPrintExcel">

                        <input id="btnPrint1" type="button" class="inputbuttonbg inputbig" value="Selected Job Work Order Schedule + Summary - Rprt 1">

                        <input id="btnPrint2" type="button" class="inputbuttonbg inputbig" value="Selected Job Work Order Schedule + Summary - Rprt 2">
                        @if (!MDS.Controllers.LoginController.AllCustomers(@User.Identity.Name))
                        {
                            <input id="btnPrint3" type="button" class="inputbuttonbg inputbig" value="Selected Job Full Details">
                        }
                    </td>
                </tr>
            </table>


            <script type="text/javascript">
                 function reportpopup(id) {
                     //window.open('Reports/ServiceJobPartsList.aspx?ServiceJobUID=' + id + '&branchID=' + @MDS.Controllers.LoginController.BranchID(@User.Identity.Name).ToString(), 'Parts', 'left=30,top=30,width=' + (screen.width - 60).toString() + ', height=' + (screen.width - 60).toString());
                     window.open('Reports/ServiceJobWorkOrderReport.aspx?ServiceJobUID=' + id + '&branchID=' + @MDS.Controllers.LoginController.BranchID(@User.Identity.Name).ToString(), 'Service', 'left=30,top=30,width=' + (screen.width - 60).toString() + ', height=' + (screen.width - 60).toString());
                     //window.open('Reports/ServicePrevMaintenance.aspx?ServiceJobUID=' + id + '&branchID=' + @MDS.Controllers.LoginController.BranchID(@User.Identity.Name).ToString(), 'WorkOrder', 'left=30,top=30,width=' + (screen.width - 60).toString() + ', height=' + (screen.width - 60).toString());
                 }
            </script>

            <table width="100%">
                <tr>
                    <td colspan="6">
                        @(Html.Kendo().Grid(Model.Service)
.Name("svGrid")
.Columns(columns =>
{
    columns.Bound(p => p.ServiceJobUID).Title("ServiceJobUID").Visible(false);
    columns.Bound(p => p.Customer).Title("Customer");
    columns.Bound(p => p.CustomerSite).Title("Customer Site");
    if (MDS.Controllers.LoginController.IsAdmin(@User.Identity.Name) == MDS.Controllers.ATC.Admin)
        columns.Bound(p => p.JobCode).Title("Job No").ClientTemplate(@Html.ActionLink("#=JobCode#", "Edit", new { id = "#=ServiceJobUID#" }).ToHtmlString());
    else if ((MDS.Controllers.LoginController.AdminTechCustomer(@User.Identity.Name) == "Tech"))
        columns.Bound(p => p.JobCode).Title("Job No").ClientTemplate(@Html.ActionLink("#=JobCode#", "Edit", "Index", new { onclick = "reportpopup(#=ServiceJobUID#);return false" }).ToHtmlString());
    else if (MDS.Controllers.LoginController.IsAdmin(@User.Identity.Name) == MDS.Controllers.ATC.Customer)
        columns.Bound(p => p.JobCode).Title("Job No").ClientTemplate(@Html.ActionLink("#=JobCode#", "Edit", "Index", new { onclick = "reportpopup(#=ServiceJobUID#);return false" }).ToHtmlString());
//    columns.Bound(p => p.EquipmentID).Title("Job No").ClientTemplate(@Html.ActionLink("#=JobCode#", "Edit", "Index", new { onclick = "reportpopup(#=ServiceId#);return false" }).ToHtmlString());
    //   columns.Bound(p => p.Equipment).Title("Job No").ClientTemplate(@Html.ActionLink("#=JobCode#", "Edit", "Index", new { onclick = "reportpopup(#=RepairUID#);return false" }).ToHtmlString());

    columns.Bound(p => p.DateProgrammed).Title("Date Programmed").ClientTemplate("#= (DateProgrammed == null) ? ' ' : kendo.toString(DateProgrammed, 'dd/MM/yyyy') #");
    columns.Bound(p => p.DateStart).Title("Date Start").ClientTemplate("#= (DateStart == null) ? ' ' : kendo.toString(DateStart, 'dd/MM/yyyy') #");
    columns.Bound(p => p.EngineerName).Title("Engineer Name");
    columns.Bound(p => p.Status).Title("Tech Status");
})
.Pageable()
.Sortable()
.Filterable()
.Selectable(s => s.Mode(GridSelectionMode.Single))
 .DataSource(dataSource => dataSource
        .Ajax()
        .PageSize(200)
        .ServerOperation(false)
     )
)
                    </td>
                </tr>

            </table>
        </div>
    </div>

    @(Html.Kendo().Window()
                            .Name("PrintSJList")
                            .Title("Service Work List")
                            .Width(1000)
                            .Height(600)
                            .Visible(false)
                            .Draggable(true)
                            .Iframe(true)
                             .Modal(true)
                            )

    @(Html.Kendo().Window()
                            .Name("PrintReport1")
                            .Title("Selected Job Work Order Schedule and Summary - Report 1")
                            .Width(1000)
                            .Height(600)
                            .Visible(false)
                            .Draggable(true)
                            .Iframe(true)
                             .Modal(true)
                            )

    @(Html.Kendo().Window()
                            .Name("PrintReport2")
                            .Title("Selected Job Work Order Schedule and Summary - Report 2")
                            .Width(1000)
                            .Height(600)
                            .Visible(false)
                            .Draggable(true)
                            .Iframe(true)
                             .Modal(true)
                            )

}
<script type="text/javascript">

    $(document).ready(function () {
        var Customeridwrapper = $("#Customerid").data("kendoDropDownList").wrapper;
        Customeridwrapper.keydown(function (e) {
            if (e.keyCode == 13) {
                $('#svForm').submit();
            }
        });

        var EngineerIDwrapper = $("#EngineerID").data("kendoDropDownList").wrapper;
        EngineerIDwrapper.keydown(function (e) {
            if (e.keyCode == 13) {
                $('#svForm').submit();
            }
        });

        var Departmentwrapper = $("#Department").data("kendoDropDownList").wrapper;
        Departmentwrapper.keydown(function (e) {
            if (e.keyCode == 13) {
                $('#svForm').submit();
            }
        });

        var Locationidwrapper = $("#Locationid").data("kendoDropDownList").wrapper;
        Locationidwrapper.keydown(function (e) {
            if (e.keyCode == 13) {
                $('#svForm').submit();
            }
        });

        var Branchidwrapper = $("#Branchid").data("kendoDropDownList").wrapper;
        Branchidwrapper.keydown(function (e) {
            if (e.keyCode == 13) {
                $('#svForm').submit();
            }
        });

        var SelCntwrapper = $("#SelCnt").data("kendoDropDownList").wrapper;
        SelCntwrapper.keydown(function (e) {
            if (e.keyCode == 13) {
                $('#svForm').submit();
            }
        });
    });
    $('select').keypress(function (e) {
        {
            if (event.which == 13) {
                alert('enter');
                //alert('search');
                //$(this).closest('form').submit();
                $('#svForm').submit();
                return false;
            }
        }
    });

    $('input').keypress(function (e) {
        {
            if (event.which == 13) {
                //alert('search');
                //$(this).closest('form').submit();
                $('#svForm').submit();
                return false;
            }
        }
    });


    function ChkDateInFilterCheck() {
        if ($("#ChkDateInFilter").is(":checked")) {
            $(".datein").show();
            $("#DateInFilter").val(true);
        }
        else {
            $(".datein").hide();
            $("#DateInFilter").val(false);
        }
    }

    function ChkDateOutFilterClick() {
        if ($("#ChkDateOutFilter").is(":checked")) {
            $(".dateout").show();
            $("#DateOutFilter").val(true);
        }
        else {
            $(".dateout").hide();
            $("#DateOutFilter").val(false);
        }
    }

</script>
<script>
    $("#rpForm").kendoValidator({
    });

</script>
<script>
  //  $('input[name=Customerid]').on('change', function () {
   //     sessionStorage.setItem('Customerids', $(this).val());
   // });
    $('input[name=Department]').on('change', function () {
        sessionStorage.setItem('Departments', $(this).val());
    });
    $(document).ready(function () {
//        $("input[name=Customerid]").data('kendoDropDownList').value(sessionStorage.getItem('Customerids'));
       $("input[name=Department]").data('kendoDropDownList').value(sessionStorage.getItem('Departments'));
        var DateInFilter = '@Model.DateInFilter';
        var DateOutFilter = '@Model.DateOutFilter';

        if (DateInFilter == "True") {
            $(".datein").show();
        }
        else {
            $(".datein").hide();
        }
        if (DateOutFilter == "True") {
            $(".dateout").show();
        }
        else {
            $(".dateout").hide();
        }

        $("#btnDelete").click(function() {
            var entityGrid = $("#svGrid").data("kendoGrid");
            var selectedItem = entityGrid.dataItem(entityGrid.select());
            if (selectedItem == undefined) {
                ShowAlert("Please select the service job first");
            }
            else {

                swal({
                    title: "",
                    text: "Are you SURE you want to delete this service job now?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "green",
                    confirmButtonText: "Yes",
                    cancelButtonText: "No",
                    closeOnConfirm: true,
                    closeOnCancel: true
                },
function (isConfirm) {
    if (isConfirm) {
        var ServiceID = selectedItem.ServiceJobUID;
        $.ajax({
            url: '@Url.Action("DeleteService", "Service")',
            type: 'POST',
            datatype: "json",
            data: { ServiceID: ServiceID },
            success: function (response) {
                alert(response.msg);
                if(response.msg.indexOf("Successfully")>=0)
                {
                    $("#svForm").submit();
                }
            },
            error: function (req, status, error) {
            }
        });
    }
    else{
    }
});

}
        });


        $("#btnPrintExcel").click(function (event) {
            event.preventDefault();

            var bid = '@Model.Branchid';
            var FromDate;
            var ToDate;
            var dateOutFrom;
            var dateOutTo;


            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth()+1; //January is 0!

            var yyyy = today.getFullYear();
            if(dd<10){
                dd='0'+dd
            }
            if(mm<10){
                mm='0'+mm
            }
            var today = yyyy +'-'+ mm+'-'+dd;


            if ('@Model.FromDate.Year'== 1)
                FromDate = today;
            else
                FromDate = '@Model.FromDate.ToString("yyyy-MM-dd")';
            if ('@Model.ToDate.Year'== 1)
                ToDate = today;
            else
                ToDate='@Model.ToDate.ToString("yyyy-MM-dd")';

            if ('@Model.OutFromDate.Year'== 1)
                dateOutFrom=today;
            else
                dateOutFrom='@Model.OutFromDate.ToString("yyyy-MM-dd")';

            if ('@Model.OutToDate.Year'== 1)
                dateOutTo = today;
            else
                dateOutTo ='@Model.OutToDate.ToString("yyyy-MM-dd")';

            var Engineer='-1';
            if ('@Model.EngineerID'!='' && '@Model.EngineerID'!=null)
            {
                 Engineer='@Model.EngineerID';
            }
            var DateInFilter=0;
            if ('@Model.DateInFilter'!='' && '@Model.DateInFilter'!=null)
            {
                DateInFilter='@Model.DateInFilter';
            }
            var DateOutFilter=0;
            if ('@Model.DateOutFilter'!='' && '@Model.DateOutFilter'!=null)
             {
                 DateOutFilter='@Model.DateOutFilter';
            }
            var Cnt='-1';
            if ('@Model.SelCnt' != '' && '@Model.SelCnt'!=null)
                     Cnt = '@Model.SelCnt';

            var url = 'Reports/ServiceJobList.aspx?dateInFrom=' + FromDate + '&dateInTo=' + ToDate + '&customerID=' + '@Model.Customerid' + '&completeIncomplete=' + '@Model.ServiceWork' + '&BranchID=' + bid + '&Invoice=' + '@Model.Invoice' + '&ServiceJobNo=' + '@Model.ServiceJob' + '&department=' + '@Model.Department' + '&location=' + '@Model.Locationid' + '&engineerID=' + Engineer + '&custOrderNo=' + '@Model.CustomerOrderNo' + '&dateOutFrom=' + dateOutFrom + '&dateOutTo=' + dateOutTo  + '&Excel=true' + '&DateInFilter='+ DateInFilter+ '&DateOutFilter='+ DateOutFilter + '&Cnt=' + Cnt ;

            window.open(url , 'ServiceJob', 'scrollbars=yes,fullscreen=yes,left=25,top=25,width=' + (screen.width - 50).toString() + ',height=' + (screen.height - 130).toString())

        });
        $("#btnServiceJobList").click(function (event) {
            event.preventDefault();
            var bid = '@Model.Branchid';
            var FromDate;
            var ToDate;
            var dateOutFrom;
            var dateOutTo;


            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth()+1; //January is 0!

            var yyyy = today.getFullYear();
            if(dd<10){
                dd='0'+dd
            }
            if(mm<10){
                mm='0'+mm
            }
            var today = yyyy +'-'+ mm+'-'+dd;


            if ('@Model.FromDate.Year'== 1)
                FromDate = today;
            else
                FromDate = '@Model.FromDate.ToString("yyyy-MM-dd")';
            if ('@Model.ToDate.Year'== 1)
                ToDate = today;
            else
                ToDate='@Model.ToDate.ToString("yyyy-MM-dd")';

            if ('@Model.OutFromDate.Year'== 1)
                dateOutFrom=today;
            else
                dateOutFrom='@Model.OutFromDate.ToString("yyyy-MM-dd")';

            if ('@Model.OutToDate.Year'== 1)
                dateOutTo = today;
            else
                dateOutTo ='@Model.OutToDate.ToString("yyyy-MM-dd")';
            var Engineer='-1';
            if ('@Model.EngineerID'!='' && '@Model.EngineerID'!=null)
            {
                Engineer='@Model.EngineerID';
            }
            var DateInFilter=0;
            if ('@Model.DateInFilter'!='' && '@Model.DateInFilter'!=null)
             {
                 DateInFilter='@Model.DateInFilter';
            }
            var DateOutFilter=0;
            if ('@Model.DateOutFilter'!='' && '@Model.DateOutFilter'!=null)
            {
                DateOutFilter='@Model.DateOutFilter';
            }
            var Cnt='-1';
            if ('@Model.SelCnt' != '' && '@Model.SelCnt'!=null)
                            Cnt = '@Model.SelCnt';

            var url = 'Reports/ServiceJobList.aspx?dateInFrom=' + FromDate + '&dateInTo=' + ToDate + '&customerID=' + '@Model.Customerid' + '&completeIncomplete=' + '@Model.ServiceWork' + '&BranchID=' + bid + '&Invoice=' + '@Model.Invoice' + '&ServiceJobNo=' + '@Model.ServiceJob' + '&department=' + '@Model.Department' + '&location=' + '@Model.Locationid' + '&engineerID=' + Engineer + '&custOrderNo=' + '@Model.CustomerOrderNo' + '&dateOutFrom=' + dateOutFrom + '&dateOutTo=' + dateOutTo + '&Excel=false' + '&DateInFilter='+ DateInFilter+ '&DateOutFilter='+ DateOutFilter + '&Cnt=' + Cnt;

            window.open(url , 'ServiceJob', 'scrollbars=yes,fullscreen=yes,left=25,top=25,width=' + (screen.width - 50).toString() + ',height=' + (screen.height - 130).toString())

        });


        $("#btnPrint1").click(function () {

            var entityGrid = $("#svGrid").data("kendoGrid");
            var selectedItem = entityGrid.dataItem(entityGrid.select());
            if (selectedItem == undefined) {
                alert("Please select the service job first");
                return false;
            }
            var bid = '@Model.Branchid';
            var url = 'Reports/ServiceJobWorkOrderReport.aspx?ServiceJobUID=' + selectedItem.ServiceJobUID + '&BranchID=' + bid ;

            window.open(url , 'ServiceJob', 'scrollbars=yes,fullscreen=yes,left=25,top=25,width=' + (screen.width - 50).toString() + ',height=' + (screen.height - 130).toString())


            /*$.ajax({
                type: "POST",
                url: 'amp Url.Action("PrintServiceWorkOrder", "Service")',
                data: {
                    ServiceJobUID: selectedItem.ServiceJobUID
                },
                success: function (data) {

                    openCenteredWindow(data.URL);
                }
            });*/

        });

        $("#btnPrint2").click(function () {

            var entityGrid = $("#svGrid").data("kendoGrid");
            var selectedItem = entityGrid.dataItem(entityGrid.select());
            if (selectedItem == undefined) {
                alert("Please select the service job first");
                return false;
            }

            var bid = '@Model.Branchid';
            var url = 'Reports/ServicePrevMaintenance.aspx?ServiceJobUID=' + selectedItem.ServiceJobUID + '&BranchID=' + bid ;

            window.open(url , 'ServiceJob', 'scrollbars=yes,fullscreen=yes,left=25,top=25,width=' + (screen.width - 50).toString() + ',height=' + (screen.height - 130).toString())

/*            $.ajax({
                type: "POST",
                url: 'amp Url.Action("PrintServicePrevMaintenance", "Service")',
                data: {
                    ServiceJobUID: selectedItem.ServiceJobUID
                },
                success: function (data) {
                    openCenteredWindow(data.URL);
                }
            });*/

        });

        $("#btnPrint3").click(function () {

            var entityGrid = $("#svGrid").data("kendoGrid");
            var selectedItem = entityGrid.dataItem(entityGrid.select());
            if (selectedItem == undefined) {
                alert("Please select the service job first");
                return false;
            }
            var id= selectedItem.ServiceJobUID
            window.open('Reports/ServiceJobPartsList.aspx?ServiceJobUID=' + id + '&branchID=' + @MDS.Controllers.LoginController.BranchID(@User.Identity.Name).ToString(), 'Parts', 'left=30,top=30,width=' + (screen.width - 60).toString() + ', height=' + (screen.width - 60).toString());
            window.open('Reports/ServiceJobWorkOrderReport.aspx?ServiceJobUID=' + id + '&branchID=' + @MDS.Controllers.LoginController.BranchID(@User.Identity.Name).ToString(), 'Service', 'left=30,top=30,width=' + (screen.width - 60).toString() + ', height=' + (screen.width - 60).toString());
            window.open('Reports/ServicePrevMaintenance.aspx?ServiceJobUID=' + id + '&branchID=' + @MDS.Controllers.LoginController.BranchID(@User.Identity.Name).ToString(), 'WorkOrder', 'left=30,top=30,width=' + (screen.width - 60).toString() + ', height=' + (screen.width - 60).toString());

        });

        //$('#svForm').live("keypress", function (e) {
        //    //alert('test');
        //    var code = (e.keyCode ? e.keyCode : e.which);
        //    if (code == 13) {
        //        e.preventDefault();
        //        e.stopPropagation();
        //        alert('aa');
        //        $(this).closest('form').submit();
        //    }
        //});

        //$("#ChkDateInFilter").click(function () {
        //    if ($(this).is(":checked")) {
        //        $(".datein").show();
        //        $("#DateInFilter").val(true);
        //    }
        //    else {
        //        $(".datein").hide();
        //        $("#DateInFilter").val(false);
        //    }
        //});

        //$("#ChkDateOutFilter").click(function () {
        //    if ($(this).is(":checked")) {
        //        $(".dateout").show();
        //        $("#DateOutFilter").val(true);
        //    }
        //    else {
        //        $(".dateout").hide();
        //        $("#DateOutFilter").val(false);
        //    }
        //});

    });

    function CustomerSiteData() {
        return {
            Customerid: $("#Customerid").val(),
            Branchid: $("#Branchid").val()
        };
    }

    function CompMonthfn() {
        var vl = $('[name="ServiceWork"]:checked').val();
        //var vl = $('#ServiceWork').val();
        //alert(vl);
        if (vl == 'M') {
            $('#CompMonth').show();
        }
        else {
            $('#CompMonth').hide();
        }
    }
    CompMonthfn();
</script>




<script>
        $(document).ready(function () {

                $('#rpForm').live("keypress", function (e) {
                    var code = (e.keyCode ? e.keyCode : e.which);
                    if (code == 13) {
                        e.preventDefault();
                        e.stopPropagation();
                        $(this).closest('form').submit();
                    }
                });
        });
</script>


